{
    "version": "https://jsonfeed.org/version/1",
    "title": "minz的筆記本 • All posts by \"devops\" tag",
    "description": "",
    "home_page_url": "https://blog.minz.li",
    "items": [
        {
            "id": "https://blog.minz.li/DevOps/releaseDockerCache/",
            "url": "https://blog.minz.li/DevOps/releaseDockerCache/",
            "title": "刪除 WSL 環境下的 docker build cache",
            "date_published": "2024-05-30T16:00:00.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<p>在 WSL 環境下發現即使將檔案刪除，磁碟空間也沒有釋放。</p>\n<h1 id=\"將docker-build-cache-刪除\"><a class=\"anchor\" href=\"#將docker-build-cache-刪除\">#</a> 將 Docker Build Cache 刪除</h1>\n<ol>\n<li>查看目前的建置緩存</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> system <span class=\"token function\">df</span></pre></td></tr></table></figure><ul>\n<li>可以看到以下輸出</li>\n</ul>\n<figure class=\"highlight plain\"><figcaption data-lang=\"plain\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Images          9         8         28.91GB   13.19GB (45%)</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Containers      8         8         3.872GB   0B (0%)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Local Volumes   1         1         263.9kB   0B (0%)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Build Cache     64        0         44.79GB   44.79GB</pre></td></tr></table></figure><ol start=\"2\">\n<li>刪除 Build Cache</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> builder prune</pre></td></tr></table></figure><ul>\n<li>出現刪除警告後輸入 y 繼續</li>\n</ul>\n<figure class=\"highlight plain\"><figcaption data-lang=\"plain\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>WARNING! This will remove all dangling build cache. Are you sure you want to continue? [y/N]</pre></td></tr></table></figure><p>在這個步驟後發現 windows 下的磁碟空間沒有釋放。</p>\n<h1 id=\"釋放虛擬磁碟檔案\"><a class=\"anchor\" href=\"#釋放虛擬磁碟檔案\">#</a> 釋放虛擬磁碟檔案</h1>\n<ol>\n<li>將 WSL 關機</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>wsl <span class=\"token parameter variable\">--shutdown</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>進入 diskpart</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>diskpart</pre></td></tr></table></figure><ol start=\"3\">\n<li>選擇虛擬磁碟</li>\n</ol>\n<p>請替換  <code>user</code>  為自己的使用者名稱<br />\n並且依 linux 版本不同 <code>CanonicalGroupLimited.Ubuntu20.04onWindows_79rhkp1fndgsc</code>  會有所不同。</p>\n<p>虛擬磁碟可以在這裡找到 C:\\Users\\  <code>user</code>  \\AppData\\Local\\Packages\\  <code>CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc</code>  \\LocalState\\ext4.vhdx</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">select</span> vdisk <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span><span class=\"token string\">\"C:\\Users\\user\\AppData\\Local\\Packages\\CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc\\LocalState<span class=\"token entity\" title=\"\\e\">\\e</span>xt4.vhdx\"</span></pre></td></tr></table></figure><ol start=\"4\">\n<li>以只讀模式附加磁碟</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>attach vdisk <span class=\"token builtin class-name\">readonly</span></pre></td></tr></table></figure><ol start=\"5\">\n<li>壓縮虛擬磁碟</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>compact vdisk</pre></td></tr></table></figure><ol start=\"6\">\n<li>卸載虛擬磁碟</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>detach vdisk</pre></td></tr></table></figure><ol start=\"7\">\n<li>離開 diskpart</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><p>這時候磁碟空間已經釋放，可以重新啟動 WSL。</p>\n",
            "tags": [
                "DevOps",
                "Docker",
                "WSL"
            ]
        }
    ]
}