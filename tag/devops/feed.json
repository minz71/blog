{
    "version": "https://jsonfeed.org/version/1",
    "title": "minz的筆記本 • All posts by \"devops\" tag",
    "description": "",
    "home_page_url": "https://blog.minz.li",
    "items": [
        {
            "id": "https://blog.minz.li/shokaX/ShokaX_github_action/",
            "url": "https://blog.minz.li/shokaX/ShokaX_github_action/",
            "title": "ShokaX 使用 GitHub Actions 自動部署到 Github Page",
            "date_published": "2024-08-09T16:00:00.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<ol>\n<li>編輯部落格內容後使用 Git 將更變推送到 Github 私人倉庫</li>\n<li>私人倉庫的 Workflow 會將原始碼 build 成靜態網頁</li>\n<li>將 public 目錄下的檔案 (編譯後的靜態網頁)，推送到公開倉庫</li>\n<li>將這個倉庫設定為 GitHub Page</li>\n</ol>\n<p><img loading=\"lazy\" data-src=\"/assets/ShokaXPlugin/github_action_imagine.webp\" alt=\"\" title=\"流程\" width=\"60%\" /></p>\n<h1 id=\"github-actions-介紹\"><a class=\"anchor\" href=\"#github-actions-介紹\">#</a> GitHub Actions 介紹</h1>\n<p>GitHub Actions 是 GitHub 提供的一項 CI/CD（持續集成和持續部署）服務，讓使用者能夠自動化軟件開發工作流。<br />\n它允許你在特定事件發生時執行定義好的動作，例如程式碼推送、Pull Request 創建、Release 發布等，<br />\n並使用 YAML 文件來定義你的工作流。</p>\n<h1 id=\"github-actions-使用\"><a class=\"anchor\" href=\"#github-actions-使用\">#</a> GitHub Actions 使用</h1>\n<h2 id=\"在-github-setting-產生一個-key\"><a class=\"anchor\" href=\"#在-github-setting-產生一個-key\">#</a> 在 Github Setting 產生一個 Key</h2>\n<ol>\n<li>\n<p>點擊 Developer Settings<br />\n<img loading=\"lazy\" data-src=\"/assets/ShokaXPlugin/githubActionGenKey.webp\" alt=\"\" title=\"點擊 Developer Settings\" width=\"80%\" /></p>\n</li>\n<li>\n<p>點擊 Generate new token<br />\n<img loading=\"lazy\" data-src=\"/assets/ShokaXPlugin/githubActionGenKey2.webp\" alt=\"\" title=\"點擊 Generate new token\" width=\"80%\" /></p>\n</li>\n<li>\n<p>權限添加 workflow<br />\n<img loading=\"lazy\" data-src=\"/assets/ShokaXPlugin/githubActionGenKey3.webp\" alt=\"\" title=\"權限添加 workflow\" width=\"80%\" /></p>\n</li>\n<li>\n<p>回到專案的 repo Setting<br />\n<img loading=\"lazy\" data-src=\"/assets/ShokaXPlugin/githubActionSecretKey.webp\" alt=\"\" title=\"回到專案的 repo Setting\" width=\"80%\" /></p>\n</li>\n<li>\n<p>Name 填入自定義名稱， secret 填入 第 <code>3</code>  步產生的 token<br />\n<img loading=\"lazy\" data-src=\"/assets/ShokaXPlugin/githubActionSecretKey2.webp\" alt=\"\" title=\"Name 填入自定義名稱， secret 填入 第`3`步產生的 token\" width=\"80%\" /></p>\n</li>\n</ol>\n<h2 id=\"workflow-trigger\"><a class=\"anchor\" href=\"#workflow-trigger\">#</a> Workflow Trigger</h2>\n<p>當有新的提交推送到  <code>main</code>  分支時，這個工作流程會被觸發。</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token punctuation\">-</span> main</pre></td></tr></table></figure><h2 id=\"jobs\"><a class=\"anchor\" href=\"#jobs\">#</a> Jobs</h2>\n<p>這個工作流程包含一個名為 build-and-deploy 的作業。<br />\n這個作業在最新版本的 Ubuntu 環境中運行，並設置了 20 分鐘的超時限制。</p>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">timeout-minutes</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span></pre></td></tr></table></figure><h2 id=\"steps\"><a class=\"anchor\" href=\"#steps\">#</a> Steps</h2>\n<ol>\n<li>使用 actions/checkout 來將存儲庫中的所有文件和目錄複製到 GitHub Actions 執行器的工作目錄中。</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout Repository</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4</pre></td></tr></table></figure><ol start=\"2\">\n<li>設置 Node.js 環境，使用版本 18。</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Node.js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v4</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">18</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>使用 shokax-can</li>\n</ol>\n<ul>\n<li>可以在安裝其他沒有包含在 shokax-can 的 moudle，例如:  <code>hexo-generator-sitemap</code> 。</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shokax<span class=\"token punctuation\">-</span>can</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    git clone https://github.com/theme-shoka-x/shokax-can --depth=1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    cd shokax-can</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    npm install -g pnpm</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    pnpm install</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    pnpm install hexo-generator-sitemap</span></pre></td></tr></table></figure><ol start=\"4\">\n<li>將安裝好的 node_modules 複製到原本的工作目錄</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Copy Modules</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> cp <span class=\"token punctuation\">-</span>r shokax<span class=\"token punctuation\">-</span>can/node_modules node_modules</pre></td></tr></table></figure><ol start=\"5\">\n<li>全局安裝 Hexo CLI。</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Hexo CLI</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token punctuation\">-</span>g hexo<span class=\"token punctuation\">-</span>cli</pre></td></tr></table></figure><ol start=\"6\">\n<li>替換文件 post.js<br />\n 如果對主題原始碼有修改，可以在這邊替換。</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> replace</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">working-directory</span><span class=\"token punctuation\">:</span> ./</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    cp replace/post.js node_modules/hexo-theme-shokax/source/js/_app/page/post.js</span></pre></td></tr></table></figure><ol start=\"7\">\n<li>Build the Site</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> build</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">working-directory</span><span class=\"token punctuation\">:</span> ./</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    hexo generate</span></pre></td></tr></table></figure><ol start=\"8\">\n<li>使用 Algolia 進行搜索索引。它從 GitHub Secrets 中提取 HEXO_ALGOLIA_INDEXING_KEY。</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> algolia</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">working-directory</span><span class=\"token punctuation\">:</span> ./</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    export HEXO_ALGOLIA_INDEXING_KEY=$&#123; &#123; secrets.API_TOKEN_ALGOLIA_INDEXING_KEY &#125;&#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    hexo algolia</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">#                                  ^ 去掉這個空格，因為不能正確渲染 2 個括號</span></pre></td></tr></table></figure><ol start=\"9\">\n<li>Push to Another Repository<br />\n 這一步使用 <a href=\"https://cpina.github.io/push-to-another-repository-docs/\">cpina/github-action-push-to-another-repository</a>，<br />\n將生成的靜態網站文件推送到另一個存儲庫 minz71/minz71.github.io 的 main 分支，以部署到 GitHub Pages。<br />\n並使用 GitHub Secrets 中的 API_TOKEN_GITHUB 來進行身份驗證。</li>\n</ol>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Pushes to another repository</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cpina/github<span class=\"token punctuation\">-</span>action<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>to<span class=\"token punctuation\">-</span>another<span class=\"token punctuation\">-</span>repository@main</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">API_TOKEN_GITHUB</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#123;</span> secrets.API_TOKEN_GITHUB <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">#                   ^ 去掉這個空格，因為不能正確渲染 2 個括號</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">source-directory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'./public'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">destination-github-username</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'minz71'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">destination-repository-name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'minz71.github.io'</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">user-email</span><span class=\"token punctuation\">:</span> XXX@gmail.com</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">target-branch</span><span class=\"token punctuation\">:</span> main</pre></td></tr></table></figure><h1 id=\"workflows-的完整範例\"><a class=\"anchor\" href=\"#workflows-的完整範例\">#</a> Workflows 的完整範例</h1>\n<ul>\n<li>GitHub Actions 的工作流文件在  <code>.github/workflows</code>  目錄中</li>\n</ul>\n<figure class=\"highlight yml\"><figcaption data-lang=\"YAML\"><span>.github/workflows/deploy.yml</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Hexo ShokaX Build and Deploy</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">-</span> main</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">timeout-minutes</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout Repository</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Node.js</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v4</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">18</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> shokax<span class=\"token punctuation\">-</span>can</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          git clone https://github.com/theme-shoka-x/shokax-can --depth=1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          cd shokax-can</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          npm install -g pnpm</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          pnpm install</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          pnpm install hexo-generator-sitemap</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Copy Modules</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> cp <span class=\"token punctuation\">-</span>r shokax<span class=\"token punctuation\">-</span>can/node_modules node_modules</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Hexo CLI</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token punctuation\">-</span>g hexo<span class=\"token punctuation\">-</span>cli</pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\"># - name: replace</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token comment\">#   working-directory: ./</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">#   run: |</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      #     cp replace/post.js node_modules/hexo-theme-shokax/source/js/_app/page/post.js</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>          </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      - name: build</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        working-directory: ./</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        run: |</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          hexo generate</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> algolia</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token key atrule\">working-directory</span><span class=\"token punctuation\">:</span> ./</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>          export HEXO_ALGOLIA_INDEXING_KEY=$&#123; &#123; secrets.API_TOKEN_ALGOLIA_INDEXING_KEY &#125;&#125;</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>          hexo algolia</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\">#                                    ^ 去掉這個空格，因為不能正確渲染 2 個括號</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Pushes to another repository</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> cpina/github<span class=\"token punctuation\">-</span>action<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>to<span class=\"token punctuation\">-</span>another<span class=\"token punctuation\">-</span>repository@main</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>          <span class=\"token key atrule\">API_TOKEN_GITHUB</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#123;</span> secrets.API_TOKEN_GITHUB <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token comment\">#                     ^ 去掉這個空格，因為不能正確渲染 2 個括號</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>          <span class=\"token key atrule\">source-directory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'./public'</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>          <span class=\"token key atrule\">destination-github-username</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'minz71'</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>          <span class=\"token key atrule\">destination-repository-name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'minz71.github.io'</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>          <span class=\"token key atrule\">user-email</span><span class=\"token punctuation\">:</span> xxx@gmail.com</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>          <span class=\"token key atrule\">target-branch</span><span class=\"token punctuation\">:</span> main</pre></td></tr></table></figure><h1 id=\"設定github-page\"><a class=\"anchor\" href=\"#設定github-page\">#</a> 設定 GitHub Page</h1>\n<ol>\n<li>\n<p>到公開的 Repository &gt; Settings &gt; Page</p>\n</li>\n<li>\n<p>設定 Custom domain (在 DNS 添加 CNAME 紀錄)</p>\n</li>\n</ol>\n",
            "tags": [
                "DevOps",
                "Github Action"
            ]
        },
        {
            "id": "https://blog.minz.li/DevOps/releaseDockerCache/",
            "url": "https://blog.minz.li/DevOps/releaseDockerCache/",
            "title": "刪除 WSL 環境下的 docker build cache",
            "date_published": "2024-05-30T16:00:00.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<p>在 WSL 環境下，發現即使將 linux 中的檔案刪除，windows 下的磁碟空間也沒有釋放。</p>\n<h1 id=\"將docker-build-cache-刪除\"><a class=\"anchor\" href=\"#將docker-build-cache-刪除\">#</a> 將 Docker Build Cache 刪除</h1>\n<ol>\n<li>查看目前的建置緩存</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> system <span class=\"token function\">df</span></pre></td></tr></table></figure><ul>\n<li>可以看到以下輸出</li>\n</ul>\n<figure class=\"highlight plain\"><figcaption data-lang=\"plain\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Images          9         8         28.91GB   13.19GB (45%)</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Containers      8         8         3.872GB   0B (0%)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Local Volumes   1         1         263.9kB   0B (0%)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Build Cache     64        0         44.79GB   44.79GB</pre></td></tr></table></figure><ol start=\"2\">\n<li>刪除 Build Cache</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> builder prune</pre></td></tr></table></figure><ul>\n<li>出現刪除警告後輸入 y 繼續</li>\n</ul>\n<figure class=\"highlight plain\"><figcaption data-lang=\"plain\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>WARNING! This will remove all dangling build cache. Are you sure you want to continue? [y/N]</pre></td></tr></table></figure><p>在這個步驟後發現 windows 下的磁碟空間沒有釋放。</p>\n<h1 id=\"釋放虛擬磁碟檔案\"><a class=\"anchor\" href=\"#釋放虛擬磁碟檔案\">#</a> 釋放虛擬磁碟檔案</h1>\n<ol>\n<li>將 WSL 關機</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>wsl <span class=\"token parameter variable\">--shutdown</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>進入 diskpart</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>diskpart</pre></td></tr></table></figure><ol start=\"3\">\n<li>選擇虛擬磁碟</li>\n</ol>\n<p>請替換  <code>user</code>  為自己的使用者名稱<br />\n並且依 linux 版本不同 <code>CanonicalGroupLimited.Ubuntu20.04onWindows_79rhkp1fndgsc</code>  會有所不同。</p>\n<p>虛擬磁碟可以在這裡找到 C:\\Users\\  <code>user</code>  \\AppData\\Local\\Packages\\  <code>CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc</code>  \\LocalState\\ext4.vhdx</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">select</span> vdisk <span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span><span class=\"token string\">\"C:\\Users\\user\\AppData\\Local\\Packages\\CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc\\LocalState<span class=\"token entity\" title=\"\\e\">\\e</span>xt4.vhdx\"</span></pre></td></tr></table></figure><ol start=\"4\">\n<li>以只讀模式附加磁碟</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>attach vdisk <span class=\"token builtin class-name\">readonly</span></pre></td></tr></table></figure><ol start=\"5\">\n<li>壓縮虛擬磁碟</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>compact vdisk</pre></td></tr></table></figure><ol start=\"6\">\n<li>卸載虛擬磁碟</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>detach vdisk</pre></td></tr></table></figure><ol start=\"7\">\n<li>離開 diskpart</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><p>磁碟空間已經釋放後，重新啟動 WSL。</p>\n",
            "tags": [
                "DevOps",
                "Docker",
                "WSL"
            ]
        }
    ]
}