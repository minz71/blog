{
    "version": "https://jsonfeed.org/version/1",
    "title": "minz的筆記本 • All posts by \"devops\" category",
    "description": "這是一個分享我學習筆記的空間",
    "home_page_url": "https://blog.minz.li",
    "items": [
        {
            "id": "https://blog.minz.li/DevOps/watchtower/",
            "url": "https://blog.minz.li/DevOps/watchtower/",
            "title": "Watchtower 自動更新 Docker 容器",
            "date_published": "2025-08-01T16:00:00.000Z",
            "content_html": "<p><div class=\"links\"><div class=\"item\" title=\"watchtower\" style=\"--block-color:#e9546b;\"><a href=\"https://github.com/containrrr/watchtower\" class=\"image\" data-background-image=\"https://containrrr.dev/watchtower/images/logo-450px.png\"></a>\n        <div class=\"info\">\n        <a href=\"https://github.com/containrrr/watchtower\" class=\"title\">watchtower</a>\n        <p class=\"desc\">https://github.com/containrrr/watchtower</p>\n        </div></div></div></p>\n<h2 id=\"watchtower-介紹\"><a class=\"anchor\" href=\"#watchtower-介紹\">#</a> Watchtower 介紹</h2>\n<p>Watchtower 會偵測是否有新的映像可用，然後嘗試安裝新的版本，並使用新版本 image 重新啟動容器。</p>\n<h2 id=\"docker-compose-範例\"><a class=\"anchor\" href=\"#docker-compose-範例\">#</a> docker-compose 範例</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-yaml\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">services</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  watchtower</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    container_name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> watchtower</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    image</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> containrrr/watchtower:latest</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    restart</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    environment</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">      TZ</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Asia/Taipei</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">      WATCHTOWER_ROLLING_RESTART</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">true</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">      WATCHTOWER_NOTIFICATION_REPORT</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">true</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">      WATCHTOWER_NOTIFICATION_URL</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">telegram://XXX:XXX@telegram/?Chats=XXX</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    volumes</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /var/run/docker.sock:/var/run/docker.sock</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> --schedule \"0 0 1 * * *\" --cleanup app1 app2 app3</span></span>\n<span class=\"line\"></span></code></pre>\n<ul>\n<li>--interval 86400 <strong>Poll interval 以秒為間隔檢查</strong></li>\n<li>--schedule  使用 6 欄位的 <a href=\"https://pkg.go.dev/github.com/robfig/cron@v1.2.0?tab=doc#hdr-CRON_Expression_Format\">Cron expression</a>  例如:&quot;0 0 1 * * *&quot; 每天1點檢查</li>\n<li>--cleanup 容器名稱</li>\n</ul>\n<p>說明文檔: <a href=\"https://containrrr.dev/watchtower/arguments/\">https://containrrr.dev/watchtower/arguments/</a></p>\n<div class=\"note info\">\n<p>在 arm 平台使用需要注意 image 有沒有提供 arm 架構<br />\n如果該 image 只有 x86 版本也會 watchtower 拉取<br />\n並出現無法執行 image 錯誤<br />\n<a href=\"https://github.com/containrrr/watchtower/issues/1309\">GitHub issue #1309</a></p>\n</div>\n",
            "tags": [
                "Docker",
                "DevOps"
            ]
        },
        {
            "id": "https://blog.minz.li/DevOps/releaseDockerCache/",
            "url": "https://blog.minz.li/DevOps/releaseDockerCache/",
            "title": "刪除 WSL 環境下的 docker build cache",
            "date_published": "2024-05-30T16:00:00.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<p>在 WSL 環境下，發現即使將 linux 中的檔案刪除，windows下的磁碟空間也沒有釋放。</p>\n<h1 id=\"將docker-build-cache-刪除\"><a class=\"anchor\" href=\"#將docker-build-cache-刪除\">#</a> 將Docker Build Cache 刪除</h1>\n<ol>\n<li>查看目前的建置緩存</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> system</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> df</span></span></code></pre>\n<ul>\n<li>可以看到以下輸出</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-plain\"><span class=\"line\"><span>TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span></span>\n<span class=\"line\"><span>Images          9         8         28.91GB   13.19GB (45%)</span></span>\n<span class=\"line\"><span>Containers      8         8         3.872GB   0B (0%)</span></span>\n<span class=\"line\"><span>Local Volumes   1         1         263.9kB   0B (0%)</span></span>\n<span class=\"line\"><span>Build Cache     64        0         44.79GB   44.79GB</span></span></code></pre>\n<ol start=\"2\">\n<li>刪除 Build Cache</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> builder</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> prune</span></span></code></pre>\n<ul>\n<li>出現刪除警告後輸入y繼續</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-plain\"><span class=\"line\"><span>WARNING! This will remove all dangling build cache. Are you sure you want to continue? [y/N] </span></span></code></pre>\n<p>在這個步驟後發現 windows 下的磁碟空間沒有釋放。</p>\n<h1 id=\"釋放虛擬磁碟檔案\"><a class=\"anchor\" href=\"#釋放虛擬磁碟檔案\">#</a> 釋放虛擬磁碟檔案</h1>\n<ol>\n<li>將 WSL 關機</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">wsl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --shutdown</span></span></code></pre>\n<ol start=\"2\">\n<li>進入diskpart</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">diskpart</span></span></code></pre>\n<ol start=\"3\">\n<li>選擇虛擬磁碟</li>\n</ol>\n<p>請替換 <code>user</code> 為自己的使用者名稱<br />\n並且依linux版本不同<code>CanonicalGroupLimited.Ubuntu20.04onWindows_79rhkp1fndgsc</code>會有所不同。</p>\n<p>虛擬磁碟可以在這裡找到 C:\\Users\\ <code>user</code> \\AppData\\Local\\Packages\\ <code>CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc</code> \\LocalState\\ext4.vhdx</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">select</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> vdisk</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> file</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">C:\\Users\\user\\AppData\\Local\\Packages\\CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc\\LocalState\\ext4.vhdx</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<ol start=\"4\">\n<li>以只讀模式附加磁碟</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">attach</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vdisk</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> readonly</span></span></code></pre>\n<ol start=\"5\">\n<li>壓縮虛擬磁碟</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">compact</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vdisk</span></span></code></pre>\n<ol start=\"6\">\n<li>卸載虛擬磁碟</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">detach</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vdisk</span></span></code></pre>\n<ol start=\"7\">\n<li>離開diskpart</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">exit</span></span></code></pre>\n<p>磁碟空間已經釋放後，重新啟動 WSL。</p>\n",
            "tags": [
                "Docker",
                "DevOps",
                "WSL"
            ]
        }
    ]
}